<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tasky â€” Admin Dashboard</title>
<link href="https://fonts.cdnfonts.com/css/amsterdam-four" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body{
    margin:0;
    font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background:linear-gradient(135deg, rgba(255,215,0,0.6), rgba(30,144,255,0.7));
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:40px 0;
  }
  .card{
    background:rgba(255,255,255,0.9);
    border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,0.15);
    padding:24px;
    width:90%;
    max-width:1000px;
  }
  h1{font-family:'Amsterdam Four',cursive;text-align:center;margin:0 0 10px 0;color:#1c2833;}
  .stats{display:flex;gap:10px;justify-content:space-between;flex-wrap:wrap;text-align:center;}
  .stat{flex:1;min-width:160px;background:rgba(255,255,255,0.5);border-radius:12px;padding:12px;}
  .buttons{text-align:center;margin-top:20px;}
  button{padding:10px 18px;border:none;border-radius:8px;font-weight:600;background:linear-gradient(90deg,#007bff,#ffd700);color:white;cursor:pointer;margin:5px;}
</style>
</head>
<body>
  <div class="card">
    <h1>Admin Dashboard</h1>
    <div class="stats">
      <div class="stat"><h2 id="uCount">0</h2>Users</div>
      <div class="stat"><h2 id="tCount">0</h2>Tasks</div>
      <div class="stat"><h2 id="cCount">0</h2>Completed</div>
      <div class="stat"><h2 id="pCount">0</h2>Pending</div>
      <div class="stat"><h2 id="rate">0%</h2>Rate</div>
    </div>
    <canvas id="pie" style="margin-top:30px;"></canvas>
    <div class="buttons">
      <button onclick="location.href='admin.html'">Manage Users</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

<script>
const me=localStorage.getItem('currentUser');
if(me!=='admin')location.href='index.html';
function loadStats(){
  const users=JSON.parse(localStorage.getItem('users')||'{}');
  const keys=Object.keys(users).filter(k=>k!=='admin');
  let total=0,done=0,pending=0;
  keys.forEach(u=>{
    const t=users[u].tasks||[];
    total+=t.length;
    done+=t.filter(x=>x.completed).length;
    pending+=t.filter(x=>!x.completed).length;
  });
  const rate=total?Math.round((done/total)*100):0;
  uCount.textContent=keys.length;
  tCount.textContent=total;
  cCount.textContent=done;
  pCount.textContent=pending;
  rate.textContent=rate+"%";
  const ctx=document.getElementById('pie').getContext('2d');
  if(window.chart)window.chart.destroy();
  window.chart=new Chart(ctx,{type:'pie',data:{labels:['Completed','Pending'],datasets:[{data:[done,pending],backgroundColor:['#27ae60','#f39c12']}]},options:{plugins:{legend:{position:'bottom'}}}});
}
function logout(){localStorage.removeItem('currentUser');location.href='index.html';}
loadStats();
</script>
</body>
</html>
